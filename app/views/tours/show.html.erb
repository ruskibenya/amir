<br>
<br>
<br>
<br>
<br>

<div id="activity_count">
  <h1><%= @tour.name %></h1>
  <h5><%= render 'activities/count', activities: @activities %></h5>
</div>

<div id="activities">
  <% if @activities.blank? %>
    <%= @tour.name %> doesn't have any activities!
  <% else %>
    <% s = 1 %>
    <% @tour.activities.each do |activity| %>
      <div style="background-color: white">
        <%= "Stop ##{s}"  %><br>
        <button class="dropdrown_toggle"><%= "#{activity.name}" %>
            <div class="dropdown_content hidden">
              <%= render 'activities/show', activity: activity %>
            </div>
        </button>
        <%#= link_to , tour_activity_path(@tour, activity) %>
      </div>
      <% s += 1 %>
    <% end %>
  <% end %>
</div>

<div id="activity_form">
  <%= render 'activities/create_form' %>
</div>







<%# @activities.each do |activity| %>
  <!-- <div class="activity_form"> -->
  <%#= render 'activities/form' %>
    <%#= simple_form_for [@tour, activity], remote: true do |f| %>
      <%#= activity.name %>
      <!-- <input type="text" name="start_time" class="flatpickr-time" style="height: 30px;"> -->
      <!-- <input type="text" name="end_time" class="flatpickr-time" style="height: 30px;"> -->
      <%#= f.input :start_time, input_html: { class: "flatpickr-time"} %>
      <%#= f.input :end_time, input_html: { class: "flatpickr-time"} %>
      <%#= f.submit %>
    <%# end %>
  <!-- </div> -->
<%# end %>

<p> <%= link_to "Email Tour Invitations", send_invitations_path(@tour), method: :post %> </p>

<p> <%= link_to "See all tours", tours_path %> </p>


<h3>Tour's map</h3>
  <%
    markers = @activities.map do |activity|
      {
        lat: activity.latitude,
        lng: activity.longitude,
        }
    end
  %>
<div
  id="map"
  style="width: 100%; height: 600px;"
  data-markers="<%= markers.to_json %>"
  ></div>

<% content_for :after_js do %>
  <script type="text/javascript">
      document.querySelectorAll('.flatpickr-time').flatpickr({
      enableTime: true,
      minTime: "16:00",
      maxTime: "22:00"
      });
  </script>
<% end %>

<!-- script for dropdown_toggle -->
<script>
  const buttons = document.querySelectorAll(".dropdrown_toggle");
  buttons.forEach(button => {
    button.addEventListener("click", (event) => {
      // console.log("ciao");
      event.target.querySelector(".dropdown_content").classList.toggle("hidden");
    })
  })
</script>
